```
---
쿠키-세션-톰캣

세션과 쿠키의 차이점은?

세션은 서버에 저장되는 값이며, 쿠키는 클라이언트에 
저장되는 값입니다.

---
톰캣을 내리고 올릴 경우 로그인이 풀리지 않도록 
설정하는 방법

톰캣의 설정파일(server.xml)에 관련설정
(saveOnRestart)을 추가함으로써
세션유지 가능(true)

- 이는 톰캣이 StandardManager를 사용하기 때문에 
톰캣을 중지하는 시점에 세션 정보를 파일로 저장하기 
때문이다. 별도의 pathname을 지정하지 않으면 
SESSIONS.ser 라는 파일로 생성된다. 그리고 다시 
톰캣이 기동하면 SESSIONS.ser 파일에 저장된 내용이 
메모리에 올려지며 SESSIONS.ser 파일은 삭제된다

다만 유의할 점은 StandardManager의 세션 저장 
기능을 사용 할 때 반드시 shutdown.sh 등 정상적인 
방법으로 중지해야만 세션 정보가 파일로 저장된다는 
것이다. 만일 유닉스 계열 머신에서 kill -9 를 
이용하여 강제 종료시킬 경우 세션 정보가 파일로 
저장되지 않는다

때에 따라서 이러한 세션 저장 기능을 사용하고 
싶지 않을때는(ex) 톰캣을 재기동 한다거나 혹은 
굳이 기존 세션을 되살리지 않아도 되는 경우) 
스크립트를 이용하여 기동시 work 디렉토리 
내 SESSIONS.ser 파일을 삭제해도 되고, 
아니면 conf/context.xml 에 pathname=""으로 
설정하여 세션 정보 파일 생성을 막으면 된다.

(기타참고)
일반적인 서버라면 서버를 여러개 사용하여 해당 
문제를 해결 할 수있다. 특히 세션(로그인 인증 정보)
만을 담당하는 서버를 구성하는 방법이 있는데, 
그것이 바로 로그인 통합관리(SSO) 이다. 
해당 시스템을 별도로 구성해 놓고, 각각의 업무 
시스템들이 다운되어도 로그인 인증 정보는 해당 
SSO 서버에 남아 있기 때문에 해당 정보로의 인증 
처리가 가능하다. 다만 업무서버도 죽고, 
브라우져 쿠키도 날아가면 이 경우에는 답이 없다.

[ String user = 
httpSession.getAttribute("user"); ]
여기서 session의 값을 가져오는 key는 "user"입니다. 
사용자 A가 접속해도 "user"로 값을 가져오고, 
사용자 B가 접속해도 "user"로 가져오는데 어떻게 
A와 B가 접속했을때 서로 다른 결과값을 받을수 있나요? 

세션은 쿠키를 이용한다. 어떤 웹 브라우저가 서버에 
요청을 하면 서버는 세션 아이디를 할당해서 응답할 
때 함께 전달한다. 웹 브라우저는 이 세션 아이디를 
쿠키에 저장해두고 매 요청마다 세션 아이디를 함께 
전달한다. 서버는 세션 아이디를 바탕으로 사용자를 
식별하고 사용자의 데이터를 서버에 저장하여 관리한다.

사용자의 로그인 정보를 쿠키나 세션등에 저장하여 로그인 
여부를 확인할 수 있는데, 클라이언트에 저장되는 쿠키와는 
달리 세션(session) 정보는 웹 서버(컨테이너)에 저장이 
되므로 보안상 더 유리하다.

위와 같은 이유로 많은 사람들이 로그인 구현시 세션(session)
을 활용하여 많이 구현한다.
세션은 클라이언트의 브라우저 1개당 1개씩 생성이 되며, 
동일 클라이언트(동일 PC)라 할지라도 브라우저 
종류(FF,Chrome,IE)가 다르면 세션을 추가로 
생성하는게 가능하다.

---
세션은 서버에 저장되고, 쿠키는 클라이언트에 저장된다고 
하셨는데, 그럼 쿠키가 안되는 상황에서도 세션은 
사용할 수 있나요?

세션은 쿠키를 이용한다. 어떤 웹 브라우저가 서버에 
요청을 하면 서버는 세션 아이디를 할당해서 응답할 때
함께 전달한다. 웹 브라우저는 이 세션 아이디를 쿠키에 
저장해두고 매 요청마다 세션 아이디를 함께 전달한다. 
서버는 세션 아이디를 바탕으로 사용자를 식별하고 
사용자의 데이터를 서버에 저장하여 관리한다.

서버에서는 저장된 세션과 클라이언트를 매칭하기 위해서 
세션 식별정보를 클라이언트에 남겨둬야 한다. 이때 
세션식별자를 쿠키로 저장하는 것이 보편적이다. 
(쿠키에 세션 식별자를 저장하는 경우, 식별자로 
클라이언트를 유추하거나 특정할 수 없게해야만 
안전하다. 또한 중복되지 않아야 한다.)

세션/쿠키를 이용해서 클라이언트를 식별할 수 있는 
것이지, 세션/쿠키가 클라이언트를 식별해 주는것은 
아니다. 따라서 쿠키가 안되는 상황에서 세션을 
사용하려면, 세션식별자로 쿠키가 아닌 다른 값을 
이용하도록 따로 설정해줘야 한다.

(참고) - (휘발성 데이터로 쿠키를 대신하는 경우)

* was설정에 따라 세션정보를 url에 담을 수 있다.
예를들어 SPA형태로 개발할 때 로그인 인증값을 
저장할 수 있는 변수를 만들어서 로그인 인증 
토큰을 저장시키는 방법을 사용해볼 수 있다. 
시스템 메모리에 저장되다 보니 쿠키와 관계없이 
잘 작동된다. 다만 근본적인 문제해결은 되지 
못하는게, 다른 탭에선 로그인이 전혀유지 될 
수 없고 새로고침하는 순간 로그인 다시 해야하기 
때문이다. 



---
```
